<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>1h Gainers & Losers</title>
<style>
body {
    width: 480px;
    height: 480px;
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    padding: 20px;
    box-sizing: border-box;
}
h2 { font-size: 26px; margin: 10px 0; }
.item {
    display: flex;
    justify-content: space-between;
    font-size: 22px;
    margin: 6px 0;
}
.green { color: #00ff7f; }
.red { color: #ff5252; }
</style>
</head>
<body>

<h2>1h Gainers</h2>
<div id="gainers">Loading...</div>

<h2>1h Losers</h2>
<div id="losers">Loading...</div>

<script>
const API =
  "https://api.coingecko.com/api/v3/coins/markets" +
  "?vs_currency=usd" +
  "&order=market_cap_desc" +
  "&per_page=250" +
  "&page=1" +
  "&sparkline=false" +
  "&price_change_percentage=1h";

async function loadData() {
  try {
    const res = await fetch(API);
    if (!res.ok) throw new Error("API blocked");

    const data = await res.json();

    const filtered = data.filter(c =>
      c.price_change_percentage_1h_in_currency !== null &&
      c.total_volume >= 50000
    );

    const gainers = [...filtered]
      .sort((a,b)=>b.price_change_percentage_1h_in_currency - a.price_change_percentage_1h_in_currency)
      .slice(0,5);

    const losers = [...filtered]
      .sort((a,b)=>a.price_change_percentage_1h_in_currency - b.price_change_percentage_1h_in_currency)
      .slice(0,5);

    document.getElementById("gainers").innerHTML =
      gainers.map(c =>
        `<div class="item">
            <span>${c.symbol.toUpperCase()}</span>
            <span class="green">+${c.price_change_percentage_1h_in_currency.toFixed(2)}%</span>
         </div>`
      ).join("");

    document.getElementById("losers").innerHTML =
      losers.map(c =>
        `<div class="item">
            <span>${c.symbol.toUpperCase()}</span>
            <span class="red">${c.price_change_percentage_1h_in_currency.toFixed(2)}%</span>
         </div>`
      ).join("");

  } catch (e) {
    document.getElementById("gainers").innerHTML = "API blocked";
    document.getElementById("losers").innerHTML = "Retry later";
  }
}

loadData();
setInterval(loadData, 90000); // refresh every 90s
</script>

</body>
</html>
