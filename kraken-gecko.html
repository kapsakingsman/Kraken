<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>1h Gainers & Losers</title>
<style>
    body {
        width: 480px;
        height: 480px;
        margin: 0;
        background: black;
        color: white;
        font-family: Arial, sans-serif;
        padding: 20px;
        box-sizing: border-box;
    }
    h2 {
        font-size: 26px;
        margin: 10px 0;
        text-align: left;
    }
    .item {
        display: flex;
        justify-content: space-between;
        font-size: 22px;
        margin: 5px 0;
    }
    .green { color: #00ff7f; }
    .red { color: #ff5252; }
</style>
</head>
<body>

<h2>1h Gainers</h2>
<div id="gainers"></div>

<h2>1h Losers</h2>
<div id="losers"></div>

<script>
async function fetchAllPages() {
    let page = 1;
    let allData = [];
    while (true) {
        const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=${page}&sparkline=false&price_change_percentage=1h`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.length === 0) break;

        allData = allData.concat(data);
        page++;
        if (page > 8) break; // max = 8 pages (2000 coins)
    }
    return allData;
}

async function loadData() {
    try {
        const data = await fetchAllPages();

        // Filter coins with valid 1h data
        const filtered = data.filter(c =>
            c.price_change_percentage_1h_in_currency !== null &&
            c.price_change_percentage_1h_in_currency !== undefined
        );

        // Top 5 gainers
        const gainers = filtered
            .sort((a, b) =>
                b.price_change_percentage_1h_in_currency -
                a.price_change_percentage_1h_in_currency
            )
            .slice(0, 5);

        // Top 5 losers
        const losers = filtered
            .sort((a, b) =>
                a.price_change_percentage_1h_in_currency -
                b.price_change_percentage_1h_in_currency
            )
            .slice(0, 5);

        // Display
        document.getElementById("gainers").innerHTML =
            gainers.map(c => `
                <div class="item">
                    <span>${c.symbol.toUpperCase()}</span>
                    <span class="green">+${c.price_change_percentage_1h_in_currency.toFixed(2)}%</span>
                </div>
            `).join("");

        document.getElementById("losers").innerHTML =
            losers.map(c => `
                <div class="item">
                    <span>${c.symbol.toUpperCase()}</span>
                    <span class="red">${c.price_change_percentage_1h_in_currency.toFixed(2)}%</span>
                </div>
            `).join("");

    } catch (error) {
        document.body.innerHTML = "<h2>Error loading data</h2>";
    }
}

loadData();
setInterval(loadData, 60000); // refresh every minute
</script>

</body>
</html>
